<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ì§€ë„ API í…ŒìŠ¤íŠ¸</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=cdv7fz1yqk"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        #map {
            width: 100%;
            height: 500px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .success {
            background: #efe;
            color: #060;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        pre {
            background: #333;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        h1 {
            color: #333;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #0066cc;
            background: #f0f8ff;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ ë„¤ì´ë²„ ì§€ë„ API í…ŒìŠ¤íŠ¸</h1>

    <div class="info">
        <h3>í˜„ì¬ í™˜ê²½ ì •ë³´</h3>
        <div class="status">
            <strong>í˜„ì¬ URL:</strong> <span id="currentUrl"></span>
        </div>
        <div class="status">
            <strong>Referrer:</strong> <span id="referrer"></span>
        </div>
        <div class="status">
            <strong>Client ID:</strong> cdv7fz1yqk
        </div>
        <div class="status">
            <strong>API URL:</strong> https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=cdv7fz1yqk
        </div>
    </div>

    <div id="status"></div>

    <h3>ì§€ë„ í‘œì‹œ ì˜ì—­</h3>
    <div id="map"></div>

    <div class="info" style="margin-top: 20px;">
        <h3>í…ŒìŠ¤íŠ¸ ë¡œê·¸</h3>
        <pre id="log"></pre>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        const log = (message, type = 'info') => {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] [${type.toUpperCase()}] ${message}\n`;
            console.log(`[${type.toUpperCase()}]`, message);
        };

        // í™˜ê²½ ì •ë³´ í‘œì‹œ
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('referrer').textContent = document.referrer || '(ì—†ìŒ)';

        log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
        log(`í˜„ì¬ URL: ${window.location.href}`);
        log(`Referrer: ${document.referrer || '(ì—†ìŒ)'}`);

        // ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ í™•ì¸
        let checkAttempts = 0;
        const maxAttempts = 50;

        const checkNaverMaps = () => {
            checkAttempts++;
            log(`ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ í™•ì¸ ì‹œë„ ${checkAttempts}/${maxAttempts}`);

            if (typeof naver !== 'undefined' && naver.maps) {
                log('âœ… ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì„±ê³µ!', 'success');
                document.getElementById('status').innerHTML =
                    '<div class="success"><strong>âœ… ì„±ê³µ:</strong> ë„¤ì´ë²„ ì§€ë„ APIê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!</div>';

                try {
                    initMap();
                } catch (error) {
                    log(`âŒ ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`, 'error');
                    document.getElementById('status').innerHTML +=
                        `<div class="error"><strong>âŒ ì˜¤ë¥˜:</strong> ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨ - ${error.message}</div>`;
                }
            } else if (checkAttempts >= maxAttempts) {
                log('âŒ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨ (íƒ€ì„ì•„ì›ƒ)', 'error');
                document.getElementById('status').innerHTML =
                    '<div class="error"><strong>âŒ ì‹¤íŒ¨:</strong> ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Client IDì™€ URL ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</div>';
            } else {
                setTimeout(checkNaverMaps, 100);
            }
        };

        // ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜
        const initMap = () => {
            log('ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');

            const mapOptions = {
                center: new naver.maps.LatLng(37.3958, 126.9649),
                zoom: 17,
                zoomControl: true,
                zoomControlOptions: {
                    position: naver.maps.Position.TOP_RIGHT
                }
            };

            log(`ì§€ë„ ì˜µì…˜ ì„¤ì •: center(37.3958, 126.9649), zoom: 17`);

            const map = new naver.maps.Map('map', mapOptions);
            log('âœ… ì§€ë„ ê°ì²´ ìƒì„± ì™„ë£Œ', 'success');

            // ë§ˆì»¤ ì¶”ê°€
            const marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(37.3958, 126.9649),
                map: map,
                title: 'ë” íŒŒí‹°ì›€ ì•ˆì–‘'
            });
            log('âœ… ë§ˆì»¤ ì¶”ê°€ ì™„ë£Œ', 'success');

            // ì •ë³´ì°½ ì¶”ê°€
            const infoWindow = new naver.maps.InfoWindow({
                content: '<div style="padding:10px;"><strong>ë” íŒŒí‹°ì›€ ì•ˆì–‘</strong><br>5ì¸µ ì‚¬íŒŒì´ì–´í™€</div>'
            });
            log('âœ… ì •ë³´ì°½ ìƒì„± ì™„ë£Œ', 'success');

            naver.maps.Event.addListener(marker, 'click', function() {
                if (infoWindow.getMap()) {
                    infoWindow.close();
                } else {
                    infoWindow.open(map, marker);
                }
            });
            log('âœ… ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ', 'success');

            log('ğŸ‰ ëª¨ë“  ì§€ë„ ì„¤ì • ì™„ë£Œ!', 'success');
        };

        // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('load', () => {
            log('Window load ì´ë²¤íŠ¸ ë°œìƒ');
            setTimeout(checkNaverMaps, 500);
        });

        // ì—ëŸ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('error', (event) => {
            log(`âŒ ì „ì—­ ì—ëŸ¬ ë°œìƒ: ${event.message}`, 'error');
            if (event.filename && event.filename.includes('naver')) {
                document.getElementById('status').innerHTML =
                    `<div class="error"><strong>âŒ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨</strong><br>
                    ì—ëŸ¬ ë©”ì‹œì§€: ${event.message}<br>
                    íŒŒì¼: ${event.filename}<br>
                    ì¤„: ${event.lineno}</div>`;
            }
        });

        // ì½˜ì†” ì—ëŸ¬ ìº¡ì²˜
        const originalError = console.error;
        console.error = function() {
            const args = Array.from(arguments);
            log(`Console Error: ${args.join(' ')}`, 'error');
            originalError.apply(console, arguments);
        };
    </script>
</body>
</html>
